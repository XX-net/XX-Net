<h2>GoAgent日志</h2>
<div class="alert alert-info">Total Lines: 0</div> <!-- .alert -->
<div id="log-container">
    <textarea id="log" readonly></textarea>
</div>

<script type="text/javascript">
    $(function() {
        window.previousOffset = 0;
        window.offset         = 1;

        var timer = $.timer(function() {
            getLog();
        });
        timer.set({ 
            time: 2500, 
            autostart: true 
        });
    });
</script>
<script type="text/javascript">
    $(function() {
        getLog();
    });
</script>
<script type="text/javascript">
    function getLog() {
        var pageRequests = {
            'cmd': 'get_new',
            'last_no': offset
        };

        $.ajax({
            type: 'GET',
            url: 'http://127.0.0.1:8084/log',
            data: pageRequests,
            dataType: 'JSON',
            success: function(result) {
                $.each(result, function(key, value) {
                    window.offset = key;

                    if ( window.previousOffset != window.offset ) {
                        $('#log').append(value);
                        $('#log').scrollTop($('#log')[0].scrollHeight);
                    }
                });
                
                $('.alert').html('Total Lines: ' + offset);
                window.previousOffset = window.offset;
            }
        });
    }
</script>